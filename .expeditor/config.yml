# Documentation available at http://expeditor-docs.es.chef.io/
product_key: harmony

# Slack channel in Chef Software slack to send notifications about build failures, etc
slack:
  notify_channel: benthos-notify

github:
  # The Github Team primarily responsible for handling incoming Pull Requests.
  maintainer_group: chef/engineering-services

buffers:
  # If multiple PRs are merged into omnibus-software within 10 minutes of each other,
  # only trigger a build once. Defer execution at most two times before building anyways.
  - cache_builds:
      type: delay
      workload_type: github_pull_request
      delay: 600
      max_deferments: 2
      actions:
        - built_in:trigger_omnibus_expcache_build

# These actions are taken, in order they are specified, anytime a Pull Request is merged.
merge_actions:
  - built_in:trigger_omnibus_build:
      ignore_labels:
        - "Omnibus: Skip Build"
        - "Expeditor: Skip All"

# Subscription to workload action of pull request merge to master on omnibus-software
# project will allow us to trigger an uncached omnibus build for harmony
# TODO add configuration based on config files with only_if_modified:
subscriptions:
  # chef/omnibus-software
  - workload: pull_request_merged:chef/omnibus-software:master:*
    actions:
      - buffer:cache_builds
